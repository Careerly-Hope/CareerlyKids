generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model TestSession {
  id           String        @id @default(uuid())
  sessionToken String        @unique
  startedAt    DateTime      @default(now())
  expiresAt    DateTime
  status       SessionStatus @default(STARTED)
  result       TestResult?

  @@index([sessionToken])
  @@index([expiresAt])
  @@index([status])
  @@map("test_sessions")
}

model Question {
  id        Int            @id @default(autoincrement())
  category  RIASECCategory
  text      String         @db.VarChar(500)
  isActive  Boolean        @default(true)
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt

  @@index([category])
  @@index([isActive])
  @@map("questions")
}

model TestResult {
  id               String      @id @default(uuid()) @db.Uuid
  timestamp        DateTime    @default(now())
  responses        Json
  scores           Json
  careerCode       String      @db.VarChar(3)
  matchedCareers   Json
  completionTime   Int?
  deviceType       String?     @db.VarChar(50)
  jobPreferences   Json?
  sessionToken     String      @unique
  tier             String?     @db.VarChar(20)
  totalScore       Int?
  aiRecommendation Json?     
  session          TestSession @relation(fields: [sessionToken], references: [sessionToken], onDelete: Cascade)

  @@index([timestamp])
  @@index([careerCode])
  @@index([sessionToken])
  @@index([tier])
  @@map("test_results")
}

model CareerProfile {
  id          Int      @id @default(autoincrement())
  careerName  String   @unique @db.VarChar(200)
  profile     Json
  jobZone     Int      @db.SmallInt
  jobTier     Int      @default(1) @db.SmallInt
  description String
  onetCode    String?  @db.VarChar(20)
  tags        String[] @default([])
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([jobZone])
  @@index([jobTier])
  @@index([isActive])
  @@map("career_profiles")
}

enum RIASECCategory {
  R
  I
  A
  S
  E
  C
}

enum MatchType {
  BEST_FIT
  GREAT_FIT
  GOOD_FIT
}

enum SessionStatus {
  STARTED
  COMPLETED
  EXPIRED
}